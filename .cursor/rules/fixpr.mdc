---
description: Fetches Copilot/Bot feedback, PEER REVIEWS it using the local model, and applies only valid fixes.
globs: *
---
# PR Peer Reviewer (Model vs. Model)

When the user triggers this rule with a PR number (e.g., "@fixpr 15"):

1.  **PRE-FLIGHT**:
    * Ensure the current local branch matches the branch for PR #<PR_NUMBER>.
    * If not, ask the user: "Switch to branch [Branch Name]?"

2.  **GATHER CONTEXT**:
    * **Comments (MCP):** Use `get_issue_comments` to fetch feedback.
    * **Workflow Status (CLI):** Run `gh pr checks <PR_NUMBER> --json name,conclusion,databaseId`.
    * **Logs (CLI):** For failed checks, run `gh run view <databaseId> --log-failed`.

3.  **THE "SECOND OPINION" (Critical Step)**:
    * **Role:** You are the Senior Engineer. The PR comments come from "Copilot" (a Junior bot).
    * **Action:** For each Bot comment/suggestion:
        1.  Read the code at the suggested location.
        2.  **Evaluate:** Does Copilot's suggestion actually improve the code?
            * *Reject if:* It introduces a bug, breaks types, or is unnecessary bike-shedding.
            * *Reject if:* It contradicts the project's existing patterns.
            * *Accept if:* It fixes a genuine bug, typo, or optimization.

4.  **EXECUTE STRATEGY**:
    * **Priority 1: Workflow Failures.** (Always fix these firstâ€”crashes are not debatable).
    * **Priority 2: Validated Bot Feedback.** Apply ONLY the suggestions you accepted in Step 3.
    * **Priority 3: Human Comments.** (Ignore as per user preference, or flag for manual review).

5.  **VERIFY**:
    * After applying fixes, run the relevant local test (discover command via `package.json` etc.).

6.  **REPORT**:
    * **âœ… Agreed & Fixed:** List Copilot suggestions you implemented.
    * **ðŸš« Rejected:** List Copilot suggestions you ignored.
        * *Requirement:* Provide a 1-sentence technical reason for rejection (e.g., "Copilot suggested a deprecated function" or "Suggestion would cause a circular dependency").
    * **ðŸš¨ CI Fixes:** List build/test errors resolved.
